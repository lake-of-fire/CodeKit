var Q=t=>JSON.parse(JSON.stringify(t));var X=()=>String(Math.random())+"-"+Date.now().toFixed();var I=(t,s)=>new Promise((i,c)=>{if(s&&globalThis[s])return i(globalThis[s]);if(typeof globalThis.importScripts=="function")return globalThis.importScripts(t),s&&globalThis[s]?i(globalThis[s]):i(globalThis);let a=document.createElement("script");a.src=t,a.async=!0;let o=()=>{a.removeEventListener("load",d),a.removeEventListener("error",T)},d=()=>{if(o(),!s)return i("loaded: "+t);let m=setInterval(()=>{if(window[s])return clearInterval(m),i(window[s])},5)},T=()=>{o(),c("failed to load: "+t)};a.addEventListener("load",d),a.addEventListener("error",T),document.head.appendChild(a)});var W=t=>t.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1");var ee=["jspm","skypack"],te=["unpkg","jsdelivr","fastly.jsdelivr"],oe=["fastly.jsdelivr.gh","jsdelivr.gh","statically"],k={getModuleUrl:(t,{isModule:s=!0,defaultCDN:i="jspm"}={})=>{t=t.replace(/#nobundle/g,"");let c=Y(t,s,i);return c||(s?"https://jspm.dev/"+t:"https://cdn.jsdelivr.net/npm/"+t)},getUrl:(t,s)=>t.startsWith("http")?t:Y(t,!1,s||Oe())||t,cdnLists:{npm:te,module:ee,gh:oe},checkCDNs:async(t,s)=>{let i=[s,...k.cdnLists.npm].filter(Boolean);for(let c of i)try{if((await fetch(k.getUrl(t,c),{method:"HEAD"})).ok)return c}catch{}return k.cdnLists.npm[0]}},Oe=()=>{if(globalThis.appCDN)return globalThis.appCDN;try{return new URL(location.href).searchParams.get("appCDN")||k.cdnLists.npm[0]}catch{return k.cdnLists.npm[0]}},Y=(t,s,i)=>{let c=s&&t.startsWith("unpkg:")?"?module":"";t.startsWith("gh:")?t=t.replace("gh",oe[0]):t.includes(":")||(t=(i||(s?ee[0]:te[0]))+":"+t);for(let a of Fe){let[o,d]=a;if(o.test(t))return t.replace(o,d)+c}return null},Fe=[[/^(jspm:)(.+)/i,"https://jspm.dev/$2"],[/^(npm:)(.+)/i,"https://jspm.dev/$2"],[/^(node:)(.+)/i,"https://jspm.dev/$2"],[/^(skypack:)(.+)/i,"https://cdn.skypack.dev/$2"],[/^(jsdelivr:)(.+)/i,"https://cdn.jsdelivr.net/npm/$2"],[/^(fastly.jsdelivr:)(.+)/i,"https://fastly.jsdelivr.net/npm/$2"],[/^(jsdelivr.gh:)(.+)/i,"https://cdn.jsdelivr.net/gh/$2"],[/^(fastly.jsdelivr.gh:)(.+)/i,"https://fastly.jsdelivr.net/gh/$2"],[/^(statically:)(.+)/i,"https://cdn.statically.io/gh/$2"],[/^(esm.run:)(.+)/i,"https://esm.run/$2"],[/^(esm.sh:)(.+)/i,"https://esm.sh/$2"],[/^(esbuild:)(.+)/i,"https://esbuild.vercel.app/$2"],[/^(bundle.run:)(.+)/i,"https://bundle.run/$2"],[/^(unpkg:)(.+)/i,"https://unpkg.com/$2"],[/^(bundlejs:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(bundle:)(.+)/i,"https://deno.bundlejs.com/?file&q=$2"],[/^(deno:)(.+)/i,"https://deno.bundlejs.com/?file&q=https://deno.land/x/$2/mod.ts"],[/^(https:\/\/deno\.land\/.+)/i,"https://deno.bundlejs.com/?file&q=$1"],[/^(github:|https:\/\/github\.com\/)(.[^\/]+?)\/(.[^\/]+?)\/(?!releases\/)(?:(?:blob|raw)\/)?(.+?\/.+)/i,"https://deno.bundlejs.com/?file&q=https://cdn.jsdelivr.net/gh/$2/$3@$4"],[/^(gist\.github:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(gitlab:|https:\/\/gitlab\.com\/)([^\/]+.*\/[^\/]+)\/(?:raw|blob)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://gl.githack.com/$2/raw/$3"],[/^(bitbucket:|https:\/\/bitbucket\.org\/)([^\/]+\/[^\/]+)\/(?:raw|src)\/(.+?)(?:\?.*)?$/i,"https://deno.bundlejs.com/?file&q=https://bb.githack.com/$2/raw/$3"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/]+)\/revisions\/([^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/$3/files/$4"],[/^(bitbucket:)snippets\/([^\/]+\/[^\/\#\?]+)(?:\?[^#]*)?(?:\#file-(.+?))$/i,"https://bb.githack.com/!api/2.0/snippets/$2/HEAD/files/$3"],[/^(bitbucket:)\!api\/2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(api\.bitbucket:)2.0\/snippets\/([^\/]+\/[^\/]+\/[^\/]+)\/files\/(.+?)(?:\?.*)?$/i,"https://bb.githack.com/!api/2.0/snippets/$2/files/$3"],[/^(rawgit:)(.+?\/[0-9a-f]+\/raw\/(?:[0-9a-f]+\/)?.+)$/i,"https://gist.githack.com/$2"],[/^(rawgit:|https:\/\/raw\.githubusercontent\.com)(\/[^\/]+\/[^\/]+|[0-9A-Za-z-]+\/[0-9a-f]+\/raw)\/(.+)/i,"https://deno.bundlejs.com/?file&q=https://raw.githack.com/$2/$3"]];var{getUrl:A,getModuleUrl:tt}=k;var ne=A("emmet-monaco-es@5.0.0/dist/emmet-monaco.js");var _e="0.6.64",ot=A(`malinajs@${_e}/malina.js`);var re=A("monaco-emacs@0.3.0/dist/monaco-emacs.js"),se=A("monaco-vim@0.4.0/dist/monaco-vim.js");var Ve=/(import\s+?(?:(?:(?:[\w*\s{},\$]*)\s+from\s+?)|))((?:".*?")|(?:'.*?'))([\s]*?(?:;|$|))/g,Je=/(import\s*?\(\s*?((?:".*?")|(?:'.*?'))\s*?\))/g,ce=t=>[...W(t).matchAll(new RegExp(Ve)),...W(t).matchAll(new RegExp(Je))].map(s=>s[2].replace(/"/g,"").replace(/'/g,""));var ie=()=>document.querySelector("#editor-mode");var le=t=>`https://ofcncog2cu-dsn.algolia.net/1/indexes/npm-search/${encodeURIComponent(t)}?x-algolia-agent=Browser`,ae={"X-Algolia-Application-Id":"OFCNCOG2CU","X-Algolia-API-Key":"f54e21fa3a2a0160595bb058179bfb1e"},pe=["name","description","homepage","repository.url","version"],N="https://data.jsdelivr.com/v1",O={"User-Agent":"https://livecodes.io"},j=t=>{let s=t.startsWith("@"),i=s?t.slice(1):t,[c,a]=i.split("@");return[(s?"@":"")+c,a]},Ke=async(t,s=10)=>{let i={page:0,hitsPerPage:s,attributesToHighlight:[],attributesToRetrieve:pe,analyticsTags:["jsdelivr"]},[c,a]=j(t),o;if(a){let m=await B(t);typeof m=="string"&&(o=j(m)[1])}let d=await fetch(le("query"),{method:"POST",headers:{"Content-Type":"application/json; charset=UTF-8",...ae},body:JSON.stringify({query:c,...i})}).then(m=>{if(!m.ok)throw new Error("failed to fetch");return m}).then(m=>m.json()).catch(m=>({error:!0,message:m.mesage||String(m)}));if("error"in d)return d;let T=d.hits.map(m=>(m.name===c&&o&&(m.version=o),m.repository?.url&&(m.repo=m.repository?.url),m));return T.sort((m,P)=>m.name===c?-1:P.name===c?1:0),T},B=async t=>{let s=`${N}/package/resolve/npm/${t}`,i=await fetch(s,{headers:O}).then(o=>{if(!o.ok)throw new Error("failed to fetch");return o}).then(o=>o.json()).catch(o=>({error:!0,message:o.mesage||String(o)}));if("error"in i)return i;let c=j(t)[0],a=i.version;return a?`${c}@${a}`:c},ze=async t=>{let[s,i]=j(t),c;if(i){let d=await B(t);typeof d=="string"&&(c=j(d)[1])}let a=le(s)+"&attributesToRetrieve="+pe.join(","),o=await fetch(a,{method:"GET",headers:ae}).then(d=>{if(!d.ok)throw new Error("failed to fetch");return d}).then(d=>d.json()).catch(d=>({error:!0,message:d.mesage||String(d)}));return"error"in o||(c&&(o.version=c),o.repository?.url&&(o.repo=o.repository?.url)),o},Ge=async t=>{let s=await B(t),i=`${N}/package/npm/${s}/flat`,c=await fetch(i,{headers:O}).then(o=>{if(!o.ok)throw new Error("failed to fetch");return o}).then(o=>o.json()).catch(o=>({error:!0,message:o.mesage||String(o)}));if("error"in c)return c;let a=`https://cdn.jsdelivr.net/npm/${s}`;return{...c.default?{default:a+c.default}:{},files:c.files.map(o=>a+o.name)}},Ze=async t=>{let s=await B(t),i=`${N}/package/npm/${s}/entrypoints`,c=await fetch(i,{headers:O}).then(o=>{if(!o.ok)throw new Error("failed to fetch");return o}).then(o=>o.json()).catch(o=>({error:!0,message:o.mesage||String(o)}));if("error"in c)return c;let a=`https://cdn.jsdelivr.net/npm/${s}`;return{...c.js?.file?{js:a+c.js?.file}:{},...c.css?.file?{css:a+c.css?.file}:{}}},ue={search:Ke,getPkgInfo:ze,getPkgFiles:Ge,getPkgDefaultFiles:Ze};var me=!1,M={},n,kt=async t=>{let{container:s,baseUrl:i,readonly:c,theme:a,isEmbed:o,getLanguageExtension:d,mapLanguage:T,getFormatterConfig:m,getFontFamily:P}=t;if(!s)throw new Error("editor container not found");let f,F=e=>({fontFamily:P(e.fontFamily),fontSize:e.fontSize||(o?12:14),insertSpaces:!e.useTabs,detectIndentation:!1,tabSize:e.tabSize,lineNumbers:e.lineNumbers?"on":"off",wordWrap:e.wordWrap?"on":"off",autoClosingBrackets:e.closeBrackets?"always":"never",autoClosingQuotes:e.closeBrackets?"always":"never",autoClosingDelete:e.closeBrackets?"always":"never"}),de=F(t),H=e=>e==="livescript"?"coffeescript":["rescript","reason","ocaml"].includes(e)?"csharp":T(e),L=i+"vendor/monaco-editor/v0.32.1";try{window.monaco=window.monaco||(await import(`${L}/monaco-editor.js`)).monaco,n=window.monaco}catch{throw new Error("Failed to load monaco editor")}n.editor.defineTheme("custom-vs-light",{base:"vs",inherit:!0,rules:[{token:"comment",fontStyle:"italic"}],colors:{}}),n.editor.defineTheme("custom-vs-dark",{base:"vs-dark",inherit:!0,rules:[{token:"comment",fontStyle:"italic"}],colors:{}});let C={theme:"custom-vs-"+a,fontLigatures:!0,formatOnType:!1,lineNumbersMinChars:3,minimap:{enabled:!1},scrollbar:{useShadows:!1},mouseWheelZoom:!0,automaticLayout:!0,readOnly:c,fixedOverflowWidgets:!0},ge={...C,scrollBeyondLastLine:!1,contextmenu:!1},fe={...C,scrollBeyondLastLine:!1},_={...C,glyphMargin:!0,folding:!1,lineDecorationsWidth:0,lineNumbersMinChars:0,scrollbar:{vertical:"auto"},scrollBeyondLastLine:!1,contextmenu:!1},xe={..._},v=t.editorId,V=v==="console"?_:v==="compiled"?fe:v==="embed"?xe:t.mode==="codeblock"?ge:C,S=Q({...de,...V});if(!document.head.querySelector("#__livecodes__monaco-styles")){let e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href",`${L}/monaco-editor.css`),e.id="__livecodes__monaco-styles",document.head.appendChild(e)}window.MonacoEnvironment={getWorkerUrl(e,r){return r==="json"?`${L}/json.worker.js`:r==="css"?`${L}/css.worker.js`:r==="scss"?`${L}/css.worker.js`:r==="sass"?`${L}/css.worker.js`:r==="less"?`${L}/css.worker.js`:r==="html"?`${L}/html.worker.js`:r==="typescript"||r==="javascript"?`${L}/ts.worker.js`:`${L}/editor.worker.js`}};let ye=()=>{let e={jsx:n.languages.typescript.JsxEmit.Preserve,allowNonTsExtensions:!0,allowJs:!1,target:n.languages.typescript.ScriptTarget.Latest,experimentalDecorators:!0,allowSyntheticDefaultImports:!0,lib:["esnext","dom"],module:n.languages.typescript.ModuleKind.ESNext};n.languages.typescript.typescriptDefaults.setCompilerOptions(e),(x==="tsx"||x==="jsx"||x==="sucrase"||x==="babel"||x==="flow")&&n.languages.typescript.typescriptDefaults.setCompilerOptions({...e,jsx:n.languages.typescript.JsxEmit.React,jsxFactory:"React.createElement",reactNamespace:"React"}),x==="stencil"&&n.languages.typescript.typescriptDefaults.setCompilerOptions({...e,jsx:n.languages.typescript.JsxEmit.Preserve,jsxFactory:void 0,reactNamespace:"h"}),x==="flow"?n.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSemanticValidation:!0}):["typescript"].includes(T(x))&&n.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSemanticValidation:!1})},$=[],he=()=>{$.forEach(e=>p.getModel()?.onDidChangeContent(e))},J="",K=(e,r,l)=>{let h=X(),g=d(l),u=H(l)==="typescript"&&!g?.endsWith("ts")&&!g?.endsWith("tsx")?g+".tsx":g;J=`file:///${v}.${h}.${u}`;let E=e.getModel(),y=n.editor.createModel(r||"",H(l),n.Uri.parse(J));e.setModel(y),setTimeout(()=>E?.dispose(),1e3),he(),ye()},x=t.language,p=n.editor.create(s,{...S,language:H(x)});K(p,t.value,x),S.theme==="vs-light"&&(s.style.backgroundColor="#fff"),(S.theme?.startsWith("http")||S.theme?.startsWith("./"))&&fetch(S.theme).then(e=>e.json()).then(e=>{n.editor.defineTheme("theme",e),n.editor.setTheme("theme"),s.style.backgroundColor=e.colors["editor.background"]});let Ee={astro:i+"{{hash:monaco-lang-astro.js}}",clio:i+"{{hash:monaco-lang-clio.js}}",imba:i+"{{hash:monaco-lang-imba.js}}",wat:i+"{{hash:monaco-lang-wat.js}}"},Le=async e=>{let r=Ee[e];if(r&&!n.languages.getLanguages().find(l=>l.id===e)){let l=(await import(r)).default;n.languages.register({id:e}),l.config&&n.languages.setLanguageConfiguration(e,l.config),l.tokens&&n.languages.setMonarchTokensProvider(e,l.tokens)}},be=()=>v,Me=()=>p.getValue(),Te=(e="")=>{p.getModel()?.setValue(e)},U=[],R=e=>!e.filename.startsWith("file:///node_modules/"),z=(e=!0)=>{U.filter(r=>e?!0:R(r)).forEach(r=>{r.libJs.dispose(),r.libTs.dispose()}),U.length=0},Se=()=>x,we=(e,r)=>{x=e,z(!1),K(p,r??p.getValue(),x),Le(e)},ke=(e,r=!1)=>{let l=U.find(h=>h.filename===e.filename);if(l){if(R(e)&&(l.libJs.dispose(),l.libJs=n.languages.typescript.javascriptDefaults.addExtraLib(e.content,e.filename)),!r)return;l.libJs?.dispose(),l.libTs?.dispose()}U.push({filename:e.filename,libJs:n.languages.typescript.javascriptDefaults.addExtraLib(e.content,e.filename),libTs:R(e)?{dispose:()=>{}}:n.languages.typescript.typescriptDefaults.addExtraLib(e.content,e.filename)})},He=()=>p.focus(),ve=()=>p.layout(),qe=e=>{$.push(e),p.getModel()?.onDidChangeContent(e)},je={CtrlEnter:n.KeyMod.CtrlCmd|n.KeyCode.Enter,ShiftEnter:n.KeyMod.Shift|n.KeyCode.Enter,Enter:n.KeyCode.Enter,UpArrow:n.KeyCode.UpArrow,DownArrow:n.KeyCode.DownArrow,ShiftAltF:n.KeyMod.Shift|n.KeyMod.Alt|n.KeyCode.KeyF},Ce=(e,r,l)=>{p.addAction({id:e,label:e,keybindings:[r],precondition:"!suggestWidgetVisible && !markersNavigationVisible && !findWidgetVisible",run:l})},G=async e=>{let r=ie(),l=document.querySelector(`#editor-status [data-status="${t.editorId}"]`),h=u=>{r&&(r.textContent=u)},g=u=>{l&&(l.textContent=u)};if(!e){f?.dispose(),f=void 0,g(""),h("");return}if(e==="vim"){if(f?.mode==="vim")return;f?.mode==="emacs"&&(f.dispose(),g(""));let u=await I(se,"MonacoVim"),E=l?.innerHTML!==""?void 0:l;f=u.initVimMode(p,E),f.mode="vim",h("Vim")}if(e==="emacs"){if(f?.mode==="emacs")return;f?.mode==="vim"&&(f.dispose(),g(""));let u=await I(re,"MonacoEmacs");f=new u.EmacsExtension(p),g(""),f.onDidMarkChange(function(E){g(E?"Mark Set!":"Mark Unset")}),f.onDidChangeKey(function(E){g(E)}),f.start(),f.mode="emacs",h("Emacs")}};G(t.editorMode);let Ue=e=>{let r=p.getModel();!e||!r||n.languages.registerDocumentFormattingEditProvider(H(x),{provideDocumentFormattingEdits:async()=>{let l=p.getValue(),h=await e(l,0,m());return[{range:r.getFullModelRange(),text:h.formatted}]}})},Ie=async()=>p.getAction("editor.action.formatDocument")?.run(),Z=e=>{!e&&!window.emmetMonaco||I(ne,"emmetMonaco").then(r=>{e?(!M.html||M.disabled)&&(M.html=r.emmetHTML(n,["html","php","astro","markdown","mdx"]),M.css=r.emmetCSS(n,["css","scss","less"]),M.jsx=r.emmetJSX(n,["javascript","typescript","jsx","tsx"]),M.disabled=!1):(M.html?.(),M.css?.(),M.jsx?.(),M.disabled=!0)})},Ae=e=>{n.editor.setTheme("custom-vs-"+e)},Be=e=>{S={...F(e),...V},Z(e.emmet),G(e.editorMode),p.updateOptions(S)},Pe=()=>{p.getModel()?.undo?.()},$e=()=>{p.getModel()?.redo?.()},Re=()=>{let e=p.getPosition();return{lineNumber:e?.lineNumber??1,column:e?.column??1}},De=e=>{let r={lineNumber:e.lineNumber,column:e.column??1};p.setPosition(r),setTimeout(()=>p.revealPositionInCenter(r,0),50)},We=()=>{Z(!1),f?.dispose(),$.length=0,z(!0),p.getModel()?.dispose(),p.dispose(),s.innerHTML=""};window.addEventListener("unhandledrejection",function(e){e.reason&&e.reason.name==="Canceled"&&e.preventDefault()});let Ne=e=>{let r=["html","markdown","javascript","typescript"],l=p.getModel();if(!l||!r.includes(H(x))||S.autoClosingBrackets==="never")return;let h=g=>["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr","circle","ellipse","line","path","polygon","polyline","rect","stop","use"].includes(g);if(e.browserEvent.key===">"){let g=p.getSelections()||[],u=[],E=[];for(let y of g){E.push(new n.Selection(y.selectionStartLineNumber,y.selectionStartColumn+1,y.endLineNumber,y.endColumn+1));let b=l.getValueInRange({startLineNumber:1,startColumn:1,endLineNumber:y.endLineNumber,endColumn:y.endColumn}).match(/<([\w-]+)(?![^>]*\/>)[^>]*$/);if(!b)continue;let[D,q]=b;h(q)||D.trim().endsWith("/")||u.push({range:{startLineNumber:y.endLineNumber,startColumn:y.endColumn+1,endLineNumber:y.endLineNumber,endColumn:y.endColumn+1},text:`</${q}>`})}setTimeout(()=>{p.executeEdits(l.getValue(),u,E)},0)}};return p.onKeyDown(Ne),me||(()=>{let e=new Map,r={provideHover(l,h){let g=l.getLineContent(h.lineNumber),u=ce(g)[0];if(!u||u.startsWith("https://")||u.startsWith("http://")||u.startsWith(".")||u.startsWith("data:")||u.startsWith("blob:"))return;/^(skypack|unpkg|jsdelivr|esm|esm\.run|esm\.sh|bundle\.run)\:/.test(u)&&(u=u.replace(/^(skypack|unpkg|jsdelivr|esm|esm\.run|esm\.sh|bundle\.run)\:/,""));let E=u.split("/"),y=E[0].startsWith("@")?2:1;return u=E.slice(0,y).join("/"),(async()=>{let w;if(e.has(u))w=e.get(u);else{if(w=await ue.getPkgInfo(u),"error"in w)return;e.set(u,w)}if(!w||"error"in w)return;let{name:b,description:D="",repo:q=""}=w;return{contents:[{value:`## [${b}](https://www.npmjs.com/package/${b})
${D}


${q?`[GitHub](${q}) |`:""} [Skypack](https://skypack.dev/view/${b}) | [jsDelivr](https://www.jsdelivr.com/package/npm/${b}) | [Unpkg](https://unpkg.com/browse/${b}/) | [Snyk](https://snyk.io/advisor/npm-package/${b}) | [Bundlephobia](https://bundlephobia.com/package/${b})

Docs: [Importing modules](${new URL("https://livecodes.io/docs/",location.href).href}features/module-resolution)`}]}})()}};n.languages.registerHoverProvider("javascript",r),n.languages.registerHoverProvider("typescript",r),n.languages.registerHoverProvider("html",r)})(),me=!0,{getValue:Me,setValue:Te,getLanguage:Se,setLanguage:we,getEditorId:be,focus:He,getPosition:Re,setPosition:De,layout:ve,addTypes:ke,changeSettings:Be,onContentChanged:qe,keyCodes:je,addKeyBinding:Ce,registerFormatter:Ue,format:Ie,isReadonly:c,setTheme:Ae,undo:Pe,redo:$e,destroy:We,monaco:p}};export{kt as createEditor};
